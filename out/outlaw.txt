# precombat
apply_poison,nonlethal = none,lethal = instant
flask
augmentation
food
snapshot_stats
use_item,name = imperfect_ascendancy_serum
stealth,precombat_seconds = 2
adrenaline_rush,precombat_seconds = 2 if talent.improved_adrenaline_rush & talent.keep_it_rolling & talent.loaded_dice
roll_the_bones,precombat_seconds = 2
adrenaline_rush,precombat_seconds = 1 if talent.improved_adrenaline_rush
slice_and_dice,precombat_seconds = 1

# actions
stealth
kick
var rtb_reroll = rtb_buffs.will_lose = (rtb_buffs.will_lose.buried_treasure + rtb_buffs.will_lose.grand_melee & targets.blade_flurry < 2 & raid_event.adds.in > 12 & raid_event.adds.count < 2)
variable,name = rtb_reroll if talent.loaded_dice,value = rtb_buffs.will_lose = loaded_dice.up
var rtb_reroll = rtb_reroll & rtb_buffs.longer = 0 | rtb_buffs.normal = 0 & rtb_buffs.longer >= 1 & rtb_buffs < 6 & rtb_buffs.max_remains <= 39 & !stealthed.all & loaded_dice.up
variable,name = rtb_reroll,op = reset if !(raid_event.adds.remains > 12 | raid_event.adds.up & (raid_event.adds.in - raid_event.adds.remains) < 6 | target.time_to_die > 12) | fight_remains < 12
var ambush_condition = (talent.hidden_opportunity | combo_points.deficit >= 2 + talent.improved_ambush + broadside.up) & energy >= 50
var finish_condition = cp >= cp_max_spend - 1 - (stealthed.all & talent.crackshot | (talent.hand_of_fate | talent.flawless_form) & talent.hidden_opportunity & (audacity.up | opportunity.up))
var blade_flurry_sync = targets.blade_flurry < 2 & raid_event.adds.in > 20 | blade_flurry.remains > gcd
call_action_list,name = cds
call_action_list,name = stealth if stealthed.all
run_action_list,name = finish if finish_condition
call_action_list,name = build
arcane_torrent if energy.base_deficit >= 15 + energy.regen
arcane_pulse
lights_judgment
bag_of_tricks

# build
echoing_reprimand
ambush if talent.hidden_opportunity & audacity.up
pistol_shot if talent.fan_the_hammer & talent.audacity & talent.hidden_opportunity & opportunity.up & !audacity.up
pistol_shot if talent.fan_the_hammer & opportunity.up & (opportunity.stack >= opportunity.max_stack | opportunity.remains < 2)
pistol_shot if talent.fan_the_hammer & opportunity.up & (combo_points.deficit >= (1 + (talent.quick_draw + broadside.up) * (talent.fan_the_hammer.rank + 1)) | combo_points <= talent.ruthlessness)
pistol_shot if !talent.fan_the_hammer & opportunity.up & (energy.base_deficit > energy.regen * 1.5 | combo_points.deficit <= 1 + broadside.up | talent.quick_draw.enabled | talent.audacity.enabled & !audacity.up)
pool_resource,for_next = 1
ambush if talent.hidden_opportunity
sinister_strike

# cds
adrenaline_rush if !adrenaline_rush.up & (!finish_condition | !talent.improved_adrenaline_rush) | stealthed.all & talent.crackshot & talent.improved_adrenaline_rush & combo_points <= 2
blade_flurry if targets >= 2 & blade_flurry.remains < gcd
blade_flurry if talent.deft_maneuvers & !finish_condition & (targets >= 3 & combo_points.deficit = targets + broadside.up | targets >= 5)
roll_the_bones if rtb_reroll | rtb_buffs = 0 | rtb_buffs.max_remains <= 7 & cooldown.vanish.ready & talent.crackshot
keep_it_rolling if rtb_buffs >= 4 & (rtb_buffs.min_remains < 2 | broadside.up)
ghostly_strike if combo_points < cp_max_spend
use_item,name = manic_grieftorch if !stealthed.all & between_the_eyes.up | fight_remains <= 5
use_item,name = beacon_to_the_beyond if !stealthed.all & between_the_eyes.up | fight_remains <= 5
use_item,name = imperfect_ascendancy_serum if !stealthed.all | fight_remains <= 22
killing_spree if finish_condition & !stealthed.all
call_action_list,name = stealth_cds if !stealthed.all & (!talent.crackshot | cooldown.between_the_eyes.ready)
thistle_tea if !thistle_tea.up & (energy.base_deficit >= 150 | fight_remains < charges * 6)
blade_rush if energy.base_time_to_max > 4 & !stealthed.all
potion if bloodlust.react | fight_remains < 30 | adrenaline_rush.up
blood_fury
berserking
fireblood
ancestral_call
use_item,name = elementium_pocket_anvil,use_off_gcd = 1 if gcd.remains <= action.sinister_strike.gcd%2
use_item,name = dragonfire_bomb_dispenser,use_off_gcd = 1 if gcd.remains <= action.sinister_strike.gcd%2 & ((!trinket.1.is.dragonfire_bomb_dispenser & trinket.1.cooldown.remains > 10 | trinket.2.cooldown.remains > 10) | cooldown.dragonfire_bomb_dispenser.charges > 2 | fight_remains < 20 | !trinket.2.has_cooldown | !trinket.1.has_cooldown)
use_item,name = stormeaters_boon if targets.blade_flurry > desired_targets | raid_event.adds.in > 60 | raid_event.adds.count < 2 | fight_remains < 10
use_item,name = enduring_dreadplate if targets.blade_flurry > desired_targets | raid_event.adds.in > 60 | raid_event.adds.count < 2 | fight_remains < 16
use_item,name = windscar_whetstone if targets.blade_flurry > desired_targets | raid_event.adds.in > 60 | raid_event.adds.count < 2 | fight_remains < 7
use_items,slots = trinket1 if between_the_eyes.up | trinket.1.has_stat.any_dps | fight_remains <= 20
use_items,slots = trinket2 if between_the_eyes.up | trinket.2.has_stat.any_dps | fight_remains <= 20

# finish
between_the_eyes if !talent.crackshot & (between_the_eyes.remains < 4 | talent.improved_between_the_eyes | talent.greenskins_wickers) & !greenskins_wickers.up
between_the_eyes if talent.crackshot & (cooldown.vanish.remains > 45 | talent.underhanded_upper_hand & talent.without_a_trace & (adrenaline_rush.remains > 10 | adrenaline_rush.down & cooldown.adrenaline_rush.remains > 45)) & (raid_event.adds.remains > 8 | raid_event.adds.in < raid_event.adds.remains | !raid_event.adds.up)
slice_and_dice if slice_and_dice.remains < fight_remains & refreshable
cold_blood
coup_de_grace
dispatch

# stealth
cold_blood if finish_condition
pool_resource,for_next = 1
between_the_eyes if finish_condition & talent.crackshot & (!shadowmeld.up | stealthed.rogue)
dispatch if finish_condition
pistol_shot if talent.crackshot & talent.fan_the_hammer.rank >= 2 & opportunity.stack >= 6 & (broadside.up & combo_points <= 1 | greenskins_wickers.up)
ambush if talent.hidden_opportunity

# stealth_cds
vanish if talent.underhanded_upper_hand & talent.subterfuge & (adrenaline_rush.up | !talent.without_a_trace & talent.crackshot) & (finish_condition | !talent.crackshot & (ambush_condition | !talent.hidden_opportunity))
vanish if !talent.underhanded_upper_hand & talent.crackshot & finish_condition
vanish if !talent.underhanded_upper_hand & !talent.crackshot & talent.hidden_opportunity & !audacity.up & opportunity.stack < opportunity.max_stack & ambush_condition
vanish if !talent.underhanded_upper_hand & !talent.crackshot & !talent.hidden_opportunity & talent.fateful_ending & (!fatebound_lucky_coin.up & (fatebound_coin_tails.stack >= 5 | fatebound_coin_heads.stack >= 5) | fatebound_lucky_coin.up & !cooldown.between_the_eyes.ready)
vanish if !talent.underhanded_upper_hand & !talent.crackshot & !talent.hidden_opportunity & !talent.fateful_ending & talent.take_em_by_surprise & !take_em_by_surprise.up
shadowmeld if finish_condition & !cooldown.vanish.ready

